<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<body>
    <ui:composition template="/layout.xhtml">
        <ui:define name="metadata">
            <f:event type="preRenderView" listener="#{researchProjectBean.initView}"/>
        </ui:define>
        <ui:define name="title">Research Projects</ui:define>
        <ui:define name="body">
            <h:form>
                <div class="row">
                    <h:link value="New Research Project" outcome="create" styleClass="pull-right"/>
                </div>

                <p:dataTable value="#{researchProjectBean.researchProjectData.values}"
                             var="project"
                             id="dataTable"
                             widgetVar="dataTable"
                             sortBy="#{project.title}"
                             sortOrder="ascending">

                    <f:facet name="header">
                        <p:outputPanel styleClass="pull-right">
                            <h:outputText value=" Search "/>
                            <p:inputText id="globalFilter" onkeyup="dataTable.filter()" style="width:150px"/>
                        </p:outputPanel>
                    </f:facet>

                    <p:column headerText="Name" sortBy="#{project.title}" sortingComparator="caseInsensitiveText"
                            filterBy="#{project.title}" filterStyleClass="hide" filterMatchMode="contains">
                        <h:link outcome="view" value="#{project.title}">
                            <f:param name="researchProject" value="#{project.businessKey}"/>
                        </h:link>
                    </p:column>

                    <p:column headerText="ID" sortBy="#{project.jiraTicketKey}" sortFunction="#{researchProjectBean.businessKeySorter.sort}"
                            filterBy="#{project.jiraTicketKey}" filterStyleClass="hide" filterMatchMode="contains">
                        <h:outputLink rendered="#{project.hasJiraTicketKey()}" target="_new"
                                      value="#{jiraLink.browseUrl(project.jiraTicketKey)}" class="external">
                            <h:outputText value="#{project.jiraTicketKey}" />
                        </h:outputLink>
                    </p:column>

                    <p:column headerText="Status" sortBy="#{project.status}" filterBy="#{project.status}" filterMatchMode="contains" filterStyleClass="hide">
                        #{project.status}
                    </p:column>

                    <p:column headerText="Owner" sortBy="#{userListBean.getUserFullName(project.createdBy)}" filterBy="#{userListBean.getUserFullName(project.createdBy)}" filterMatchMode="contains" filterStyleClass="hide">
                        #{userListBean.getUserFullName(project.createdBy)}
                    </p:column>

                    <p:column headerText="Updated" sortBy="#{project.modifiedDate}">
                        <h:outputText value="#{project.modifiedDate}">
                            <f:convertDateTime type="both" timeStyle="short"/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="# of&lt;br&gt;Orders"
                              sortBy="#{researchProjectBean.researchProjectCounts.get(project.jiraTicketKey)}">
                        <h:outputText value="#{researchProjectBean.researchProjectCounts.get(project.jiraTicketKey)}" styleClass="align-right"/>
                    </p:column>

                </p:dataTable>
            </h:form>
        </ui:define>
    </ui:composition>
</body>
</html>