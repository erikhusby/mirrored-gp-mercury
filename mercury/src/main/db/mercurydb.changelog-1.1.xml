<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <!-- changeSet ids include the ticket number, with -n appended to allow multiple changeSets per ticket.
     Keep changeSets small, it's harder to recover from an error in a large changeSet.
      -->

    <changeSet id="GPLIM-1376-1" author="thompson">
        <addColumn tableName="LAB_BATCH" schemaName="MERCURY">
            <column name="WORKFLOW_NAME" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1376-2" author="thompson">
        <addColumn tableName="LAB_BATCH_AUD" schemaName="MERCURY">
            <column name="WORKFLOW_NAME" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1377-1" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <columnExists schemaName="mercury" tableName="lv_comment" columnName="lab_event"/>
        </preConditions>
        <dropNotNullConstraint columnName="lab_event" schemaName="mercury" tableName="lv_comment"/>
    </changeSet>
    <changeSet id="GPLIM-1377-2" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <columnExists schemaName="mercury" tableName="lv_comment_aud" columnName="lab_event"/>
        </preConditions>
        <dropNotNullConstraint columnName="lab_event" schemaName="mercury" tableName="lv_comment_aud"/>
    </changeSet>
    <changeSet id="GPLIM-1377-3" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="FK_LV_COMMENT_LAB_EVENT" schemaName="mercury"/>
        </preConditions>
        <dropForeignKeyConstraint
                constraintName="FK_LV_COMMENT_LAB_EVENT" baseTableName="lv_comment" baseTableSchemaName="mercury"/>
    </changeSet>

    <changeSet id="GPLIM-1434-1" author="jcarey">
        <createTable tableName="batch_starting_vessels" schemaName="mercury">
            <column name="batch_starting_vessel_id" type="number(19,0)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="lab_vessel" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="lab_batch" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="concentration" type="number(19,2)"/>
        </createTable>

        <createIndex tableName="batch_starting_vessels" indexName="ix_lab_vessel_key">
            <column name="lab_vessel"/>
        </createIndex>

        <createIndex tableName="batch_starting_vessels" indexName="ix_lab_batch_key">
            <column name="lab_batch"/>
        </createIndex>

        <createSequence sequenceName="SEQ_BATCH_STARTING_VESSEL" schemaName="mercury" startValue="1"
                        incrementBy="50"/>
    </changeSet>
    <changeSet id="GPLIM-1434-2" author="jcarey">

        <createTable tableName="batch_starting_vessels_aud" schemaName="mercury">
            <column name="batch_starting_vessel_id" type="number(19,0)" />
            <column name="lab_vessel" type="number(19,0)" />
            <column name="lab_batch" type="number(19,0)" />
            <column name="concentration" type="number(19,2)"/>
            <column name="rev" type="number(19,0)" />
            <column name="revtype" type="number(3,0)" />
        </createTable>

        <addPrimaryKey tableName="batch_starting_vessels_aud" schemaName="mercury"
                       columnNames="batch_starting_vessel_id, rev"/>

    </changeSet>
    <changeSet id="GPLIM-1606-1" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="sequencing_run" columnName="actual_read_structure" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run" schemaName="mercury">
            <column name="actual_read_structure" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1606-2" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="sequencing_run_aud" columnName="actual_read_structure" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run_aud" schemaName="mercury">
            <column name="actual_read_structure" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1606-3" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="sequencing_run" columnName="setup_read_structure" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run" schemaName="mercury">
            <column name="setup_read_structure" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1606-4" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="sequencing_run_aud" columnName="setup_read_structure" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run_aud" schemaName="mercury">
            <column name="setup_read_structure" type="varchar(255)"></column>
        </addColumn>
    </changeSet>

    <changeSet id="GPLIM-1377-4" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ENTRY_TYPE" schemaName="mercury" tableName="BUCKET_ENTRY"/>
            </not>
        </preConditions>
        <addColumn tableName="BUCKET_ENTRY" schemaName="mercury">
            <column name="ENTRY_TYPE" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1377-5" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ENTRY_TYPE" schemaName="mercury" tableName="BUCKET_ENTRY_AUD"/>
            </not>
        </preConditions>
        <addColumn tableName="BUCKET_ENTRY_AUD" schemaName="mercury">
            <column name="ENTRY_TYPE" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1377-6" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="ENTRY_TYPE" schemaName="mercury" tableName="BUCKET_ENTRY"/>
        </preConditions>
        <update schemaName="mercury" tableName="BUCKET_ENTRY">
            <column name="ENTRY_TYPE" value="PDO_ENTRY"></column>
            <where>ENTRY_TYPE is null</where>
        </update>
    </changeSet>
    <changeSet id="GPLIM-1377-7" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="ENTRY_TYPE" schemaName="mercury" tableName="BUCKET_ENTRY_AUD"/>
        </preConditions>
        <update schemaName="mercury" tableName="BUCKET_ENTRY_AUD">
            <column name="ENTRY_TYPE" value="PDO_ENTRY"></column>
            <where>ENTRY_TYPE is null</where>
        </update>
    </changeSet>

    <changeSet id="GPLIM-1377-8" author="breilly">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="rework_detail" schemaName="mercury"/>
            </not>
        </preConditions>
        <createTable tableName="rework_detail" schemaName="mercury">
            <column name="rework_detail_id" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="rework_level" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="rework_reason" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="rework_step" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="rework_comment" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="rework_detail" schemaName="mercury" columnNames="rework_detail_id"/>
        <createSequence sequenceName="SEQ_REWORK_DETAIL" schemaName="mercury" startValue="1" incrementBy="50"/>
    </changeSet>
    <changeSet id="GPLIM-1377-9" author="breilly">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="rework_detail_aud" schemaName="mercury"/>
            </not>
        </preConditions>
        <createTable tableName="rework_detail_aud" schemaName="mercury">
            <column name="rework_detail_id" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="rev" type="number(19,0)">
                <constraints nullable="true"/>
            </column>
            <column name="revtype" type="number(3,0)">
                <constraints nullable="true"/>
            </column>
            <column name="rework_level" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="rework_reason" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="rework_step" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="rework_comment" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="rework_detail_aud" schemaName="mercury" columnNames="rework_detail_id, rev"/>
        <addForeignKeyConstraint baseTableName="rework_detail_aud" baseTableSchemaName="mercury" baseColumnNames="rev"
                                 constraintName="fk_rework_detail_aud_rev_info"
                                 referencedTableName="rev_info" referencedTableSchemaName="mercury"
                                 referencedColumnNames="rev_info_id"/>
    </changeSet>
    <changeSet id="GPLIM-1377-10" author="breilly">
        <addColumn tableName="bucket_entry" schemaName="mercury">
            <column name="rework_detail_id" type="number(19,0)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
        <addForeignKeyConstraint baseTableName="bucket_entry" baseTableSchemaName="mercury"
                                 baseColumnNames="rework_detail_id"
                                 constraintName="fk_bucket_entry_rework_detail"
                                 referencedTableName="rework_detail" referencedTableSchemaName="mercury"
                                 referencedColumnNames="rework_detail_id"/>
    </changeSet>
    <changeSet id="GPLIM-1377-11" author="breilly">
        <addColumn tableName="bucket_entry_aud" schemaName="mercury">
            <column name="rework_detail_id" type="number(19,0)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1377-12" author="breilly">
        <addColumn tableName="rework_detail">
            <column name="add_to_rework_bucket_event_id" type="number(19,0)"/>
        </addColumn>
        <addColumn tableName="rework_detail_aud">
            <column name="add_to_rework_bucket_event_id" type="number(19,0)"/>
        </addColumn>
        <addForeignKeyConstraint baseTableName="rework_detail" baseTableSchemaName="mercury"
                                 baseColumnNames="add_to_rework_bucket_event_id"
                                 constraintName="fk_rework_detail_lab_event"
                                 referencedTableName="lab_event" referencedTableSchemaName="mercury"
                                 referencedColumnNames="lab_event_id"/>
    </changeSet>

    <changeSet id="GPLIM-1688" author="andrew">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="sequencing_run" columnName="imaged_area_permm2" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run" schemaName="mercury">
            <column name="imaged_area_permm2" type="number(15,10)"></column>
        </addColumn>
    </changeSet>

    <changeSet id="GPLIM-1688-1" author="andrew">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="sequencing_run_aud" columnName="imaged_area_permm2" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run_aud" schemaName="mercury">
            <column name="imaged_area_permm2" type="number(15,10)"></column>
        </addColumn>
    </changeSet>

    <changeSet id="GPLIM-1688-2" author="andrew">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="sequencing_run" columnName="lanes_sequenced" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run" schemaName="mercury">
            <column name="lanes_sequenced" type="varchar(255)"></column>
        </addColumn>
    </changeSet>

    <changeSet id="GPLIM-1688-3" author="andrew">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="sequencing_run_aud" columnName="lanes_sequenced" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run_aud" schemaName="mercury">
            <column name="lanes_sequenced" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    
    <changeSet author="scottmat" id="GPLIM-1698-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="dilution_vessel" schemaName="mercury" tableName="batch_starting_vessels" />
            </not>
        </preConditions>
        <addColumn tableName="batch_starting_vessels" schemaName="mercury">
            <column name="dilution_vessel" type="number(19,0)" />
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="dilution_vessel" baseTableName="batch_starting_vessels"
                                 baseTableSchemaName="mercury" constraintName="fk_starting_vessel_dilution"
                                 referencedColumnNames="lab_vessel_id" referencedTableName="lab_vessel"
                                 referencedTableSchemaName="mercury" />
        <createIndex indexName="idx_lab_batch_dilution" tableName="batch_starting_vessels" >
            <column name="dilution_vessel" type="number(19,0)"/>
        </createIndex>
    </changeSet>
    <changeSet author="scottmat" id="GPLIM-1698-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="dilution_vessel" schemaName="mercury" tableName="batch_starting_vessels_aud" />
            </not>
        </preConditions>
        <addColumn tableName="batch_starting_vessels_aud" schemaName="mercury">
            <column name="dilution_vessel" type="number(19,0)" />
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1874-3" author="epolk">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="vessel_position" schemaName="mercury" tableName="lab_metric" />
            </not>
        </preConditions>
        <addColumn tableName="lab_metric" schemaName="mercury">
            <column name="vessel_position" type="varchar2(255)"/>
            <column name="created_date" type="timestamp"></column>
        </addColumn>
    </changeSet>
    <changeSet id="gplim-1874-4" author="epolk">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="vessel_position" schemaName="mercury" tableName="lab_metric_aud" />
            </not>
        </preConditions>
        <addColumn tableName="lab_metric_aud" schemaName="mercury">
            <column name="vessel_position" type="varchar2(255)"/>
            <column name="created_date" type="timestamp"></column>
        </addColumn>
    </changeSet>

    <changeSet id="GPLIM-1968-1" author="dryan">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="lab_event" columnName="PROGRAM_NAME" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="lab_event">
            <column name="PROGRAM_NAME" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1968-2" author="dryan">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="lab_event_aud" columnName="PROGRAM_NAME" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="lab_event_aud">
            <column name="PROGRAM_NAME" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="GPLIM-2386-1" author="thompson">
        <addForeignKeyConstraint constraintName="FK_BSV_LAB_BATCH"
                baseTableName="batch_starting_vessels" baseTableSchemaName="mercury" baseColumnNames="lab_batch"
                referencedTableName="lab_batch" referencedTableSchemaName="mercury" referencedColumnNames="lab_batch_id"/>
    </changeSet>
    <changeSet id="GPLIM-2386-2" author="thompson">
        <addForeignKeyConstraint constraintName="FK_BSV_LAB_VESSEL"
                baseTableName="batch_starting_vessels" baseTableSchemaName="mercury" baseColumnNames="lab_vessel"
                referencedTableName="lab_vessel" referencedTableSchemaName="mercury" referencedColumnNames="lab_vessel_id"/>
    </changeSet>

    <changeSet id="GPLIM-2450-1" author="thompson">
        <addColumn schemaName="mercury" tableName="lab_event">
            <column name="manual_override_lc_set" type="number(19,0)"/>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-2450-2" author="thompson">
        <addColumn schemaName="mercury" tableName="lab_event_aud">
            <column name="manual_override_lc_set" type="number(19,0)"/>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-2450-3" author="thompson">
        <addForeignKeyConstraint constraintName="FK_LV_MANUAL_LCSET"
                baseTableSchemaName="mercury" baseTableName="lab_event" baseColumnNames="manual_override_lc_set"
                referencedTableSchemaName="mercury" referencedTableName="lab_batch" referencedColumnNames="lab_batch_id"/>
    </changeSet>
    
    <changeSet id="GPLIM-2079-1" author="thompson">
        <addColumn schemaName="mercury" tableName="LAB_VESSEL">
            <column name="receptacle_weight" type="number(19,2)"/>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-2079-2" author="thompson">
        <addColumn schemaName="mercury" tableName="LAB_VESSEL_AUD">
            <column name="receptacle_weight" type="number(19,2)"/>
        </addColumn>
    </changeSet>

    <changeSet author="scottmat" id="GPLIM-2485-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="rework_reason" schemaName="mercury" />
            </not>
        </preConditions>
        <createTable tableName="rework_reason">
            <column name="rework_reason_id" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="reason" type="varchar(255)" />
        </createTable>
        <addPrimaryKey tableName="rework_reason" schemaName="mercury" columnNames="rework_reason_id"/>
        <createIndex tableName="rework_reason" indexName="IDX_rework_reason_value" schemaName="mercury" unique="true">
            <column name="reason" />
        </createIndex>
        <createSequence sequenceName="SEQ_REWORK_REASON" schemaName="mercury" startValue="1" incrementBy="50"/>
    </changeSet>

    <changeSet author="scottmat" id="GPLIM-2485-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="rework_reason_aud" schemaName="mercury" />
            </not>
        </preConditions>
        <createTable tableName="rework_reason_aud">
            <column name="rework_reason_id" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="reason" type="varchar(255)" />
            <column name="rev" type="number(19,0)" />
            <column name="revtype" type="number(3,0)" />
        </createTable>
        <addPrimaryKey tableName="rework_reason_aud" schemaName="mercury" columnNames="rework_reason_id, rev"/>
    </changeSet>

    <changeSet id="GPLIM-2485-3" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="rework_detail" columnName="user_defined_reason" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="rework_detail" schemaName="mercury">
            <column name="user_defined_reason" type="number(19,0)" />
        </addColumn>
        <createIndex tableName="rework_detail" indexName="IDX_REWORK_DETAIL_REASON" schemaName="mercury">
            <column name="user_defined_reason" />
        </createIndex>
    </changeSet>
    <changeSet id="GPLIM-2485-4" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="rework_detail_aud" columnName="user_defined_reason" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="rework_detail_aud" schemaName="mercury">
            <column name="user_defined_reason" type="number(19,0)" />
        </addColumn>
    </changeSet>

    <changeSet author="thompson" id="GPLIM-2386-1a">
        <sql>grant references on mercury.mercury_sample to athena</sql>
    </changeSet>

    <changeSet id="GPLIM-2485-drop-old-reason" author="scottmat">
        <preConditions>
            <columnExists tableName="rework_detail" columnName="rework_reason" schemaName="mercury" />
        </preConditions>
        <dropColumn tableName="rework_detail" columnName="rework_reason" schemaName="mercury" />
    </changeSet>
    <changeSet author="thompson" id="GPLIM-2359-1">
        <addColumn schemaName="mercury" tableName="lab_vessel">
            <column name="lane_number" type="number(10,0)"/>
            <column name="flowcell" type="number(19,0)"/>
        </addColumn>
    </changeSet>
    <changeSet author="thompson" id="GPLIM-2359-2">
        <addColumn schemaName="mercury" tableName="lab_vessel_aud">
            <column name="lane_number" type="number(10,0)"/>
            <column name="flowcell" type="number(19,0)"/>
        </addColumn>
    </changeSet>
    <changeSet author="thompson" id="GPLIM-2359-3">
        <createTable schemaName="mercury" tableName="sequencing_run_chamber">
            <column name="sequencing_run_chamber_id" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="dtype" type="varchar2(31)">
                <constraints nullable="false"/>
            </column>
            <column name="actual_read_structure" type="varchar2(255)"/>
            <column name="lane_number" type="number(10,0)"/>
            <column name="illumina_sequencing_run" type="number(19,0)"/>
        </createTable>
        <addPrimaryKey schemaName="mercury" tableName="sequencing_run_chamber" columnNames="sequencing_run_chamber_id"/>
    </changeSet>
    <changeSet author="thompson" id="GPLIM-2359-4">
        <createTable schemaName="mercury" tableName="sequencing_run_chamber_aud">
            <column name="sequencing_run_chamber_id" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="dtype" type="varchar2(31)">
                <constraints nullable="false"/>
            </column>
            <column name="rev" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="revtype" type="number(3,0)"/>
            <column name="actual_read_structure" type="varchar2(255)"/>
            <column name="lane_number" type="number(10,0)"/>
            <column name="illumina_sequencing_run" type="number(19,0)"/>
        </createTable>
        <addPrimaryKey schemaName="mercury" tableName="sequencing_run_chamber_aud" columnNames="sequencing_run_chamber_id, rev"/>
    </changeSet>
    <changeSet author="thompson" id="GPLIM-2359-5">
        <addForeignKeyConstraint constraintName="FK_LV_FLOWCELL"
                baseTableSchemaName="mercury" baseTableName="lab_vessel" baseColumnNames="flowcell"
                referencedTableSchemaName="mercury" referencedTableName="lab_vessel" referencedColumnNames="lab_vessel_id"/>
        <addForeignKeyConstraint constraintName="FK_SRC_SEQUENCING_RUN"
                baseTableSchemaName="mercury" baseTableName="sequencing_run_chamber" baseColumnNames="illumina_sequencing_run"
                referencedTableSchemaName="mercury" referencedTableName="sequencing_run" referencedColumnNames="sequencing_run_id"/>
        <addForeignKeyConstraint constraintName="FK_SRCA_REF_INFO"
                baseTableSchemaName="mercury" baseTableName="sequencing_run_chamber_aud" baseColumnNames="rev"
                referencedTableSchemaName="mercury" referencedTableName="rev_info" referencedColumnNames="REV_INFO_ID"/>
    </changeSet>
    <changeSet author="thompson" id="GPLIM-2359-6">
        <createSequence schemaName="mercury" sequenceName="SEQ_SEQUENCING_RUN_CHAMBER" incrementBy="50" startValue="1"/>
    </changeSet>

    <changeSet author="scottmat" id="GPLIM-2711-add-product-order-reference">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="product_order" tableName="bucket_entry" schemaName="mercury" />
            </not>
        </preConditions>
        <addColumn tableName="bucket_entry" schemaName="mercury">
            <column name="product_order_id" type="number(19,0)" />
        </addColumn>
    </changeSet>
    <changeSet author="scottmat" id="GPLIM-2711-add-product-order-reference-aud">

        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="product_order" tableName="bucket_entry_aud" schemaName="mercury" />
            </not>
        </preConditions>
        <addColumn tableName="bucket_entry_aud" schemaName="mercury">
            <column name="product_order_id" type="number(19,0)" />
        </addColumn>
    </changeSet>
    <!--Uncoment after the proper grants are applied on next build-->
    <!--<changeSet author="scottmat" id="GPLIM-2711-product-order-fk">-->
        <!--<preConditions onFail="MARK_RAN">-->
            <!--<not>-->
                <!--<foreignKeyConstraintExists foreignKeyName="FK_BUCKET_ENTRY_TO_PDO" foreignKeyTableName="bucket_entry"-->
                                            <!--schemaName="Mercury"/>-->
            <!--</not>-->
        <!--</preConditions>-->
        <!--<addForeignKeyConstraint constraintName="FK_BUCKET_ENTRY_TO_PDO" baseColumnNames="product_order"-->
                                 <!--baseTableName="bucket_entry" baseTableSchemaName="mercury"-->
                                 <!--referencedColumnNames="product_order_id" referencedTableName="product_order"-->
                                 <!--referencedTableSchemaName="athena" />-->
    <!--</changeSet>-->

    <changeSet author="epolk" id="GPLIM-2683-1a">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="tube_type" tableName="lab_vessel" schemaName="mercury" />
            </not>
        </preConditions>
        <addColumn tableName="lab_vessel" schemaName="mercury">
            <column name="tube_type" type="varchar2(255)" />
        </addColumn>
    </changeSet>

    <changeSet author="epolk" id="GPLIM-2683-2a">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="tube_type" tableName="lab_vessel_aud" schemaName="mercury" />
            </not>
        </preConditions>
        <addColumn tableName="lab_vessel_aud" schemaName="mercury">
            <column name="tube_type" type="varchar2(255)" />
        </addColumn>
    </changeSet>

    <changeSet author="epolk" id="GPLIM-2683-3c">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
	        SELECT distinct 1 FROM lab_vessel WHERE dtype = 'TwoDBarcodedTube';
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE lab_vessel SET dtype = 'BarcodedTube', tube_type = 'MatrixTube' WHERE dtype = 'TwoDBarcodedTube';
        </sql>
    </changeSet>

</databaseChangeLog>
