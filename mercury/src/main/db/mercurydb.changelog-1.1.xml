<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <!-- changeSet ids include the ticket number, with -n appended to allow multiple changeSets per ticket.
     Keep changeSets small, it's harder to recover from an error in a large changeSet.
      -->

    <changeSet id="GPLIM-1376-1" author="thompson">
        <addColumn tableName="LAB_BATCH" schemaName="MERCURY">
            <column name="WORKFLOW_NAME" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1376-2" author="thompson">
        <addColumn tableName="LAB_BATCH_AUD" schemaName="MERCURY">
            <column name="WORKFLOW_NAME" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1377-1" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <columnExists schemaName="mercury" tableName="lv_comment" columnName="lab_event"/>
        </preConditions>
        <dropNotNullConstraint columnName="lab_event" schemaName="mercury" tableName="lv_comment"/>
    </changeSet>
    <changeSet id="GPLIM-1377-2" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <columnExists schemaName="mercury" tableName="lv_comment_aud" columnName="lab_event"/>
        </preConditions>
        <dropNotNullConstraint columnName="lab_event" schemaName="mercury" tableName="lv_comment_aud"/>
    </changeSet>
    <changeSet id="GPLIM-1377-3" author="scottmat">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="FK_LV_COMMENT_LAB_EVENT" schemaName="mercury"/>
        </preConditions>
        <dropForeignKeyConstraint
                constraintName="FK_LV_COMMENT_LAB_EVENT" baseTableName="lv_comment" baseTableSchemaName="mercury"/>
    </changeSet>

    <changeSet id="GPLIM-1434-1" author="jcarey">
        <createTable tableName="batch_starting_vessels" schemaName="mercury">
            <column name="batch_starting_vessel_id" type="number(19,0)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="lab_vessel" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="lab_batch" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="concentration" type="number(5,5)"/>
        </createTable>

        <createIndex tableName="batch_starting_vessels" indexName="ix_lab_vessel_key">
            <column name="lab_vessel"/>
        </createIndex>

        <createIndex tableName="batch_starting_vessels" indexName="ix_lab_batch_key">
            <column name="lab_batch"/>
        </createIndex>

        <createSequence sequenceName="SEQ_BATCH_STARTING_VESSEL" schemaName="mercury" startValue="1"
                        incrementBy="50"/>
    </changeSet>
    <changeSet id="GPLIM-1434-2" author="jcarey">

        <createTable tableName="batch_starting_vessels_aud" schemaName="mercury">
            <column name="batch_starting_vessel_id" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="lab_vessel" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="lab_batch" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="concentration" type="number(5,5)"/>
            <column name="rev" type="number(19,0)">
                <constraints nullable="false"/>
            </column>
            <column name="revtype" type="number(3,0)">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <addPrimaryKey tableName="batch_starting_vessels_aud" schemaName="mercury"
                       columnNames="batch_starting_vessel_id, rev"/>

    </changeSet>
    <changeSet id="GPLIM-1606-1" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="sequencing_run" columnName="actual_read_structure" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run" schemaName="mercury">
            <column name="actual_read_structure" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1606-2" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="sequencing_run_aud" columnName="actual_read_structure" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run_aud" schemaName="mercury">
            <column name="actual_read_structure" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1606-3" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="sequencing_run" columnName="setup_read_structure" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run" schemaName="mercury">
            <column name="setup_read_structure" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="GPLIM-1606-4" author="scottmat">
        <preConditions>
            <not>
                <columnExists tableName="sequencing_run_aud" columnName="setup_read_structure" schemaName="mercury"/>
            </not>
        </preConditions>
        <addColumn tableName="sequencing_run_aud" schemaName="mercury">
            <column name="setup_read_structure" type="varchar(255)"></column>
        </addColumn>
    </changeSet>

</databaseChangeLog>